# On-the-fly autonomous control of neutron diffraction via physics-informed Bayesian active learning

## ABSTRACT

我々は、自律型中性子回折実験装置ANDiEを開発・配備し、中性子回折実験をライブで自律的に制御することを初めて実証した。
中性子散乱は、物質の磁気構造と挙動を調べるためのユニークで汎用性の高い特性評価技術である。
しかし、世界の中性子散乱実験施設は限られており、また、そのような施設では常に過剰な需要が発生している。
我々は、機械学習による測定パラメータ空間の自律的なナビゲーションを実装することで、中性子回折実験に必要な時間を大幅に短縮することを実証する。
事前の科学的知識とベイズ型能動学習によって、測定の順序を動的に制御する。
ANDiEは、MnOとFe1.09Teの磁気秩序転移を実験的に決定し、同時に測定効率を5倍向上させることができることを示した。
さらに、仮説検証の後処理として、ANDiEは可能性のある物理モデルの集合から転移挙動を決定することができた。
ANDiEの能動的学習アプローチは、様々な中性子実験に広く適用でき、材料探索を加速するツールとして中性子散乱の扉を開くことができる。

## I. INTRODUCTION

ベイズ型自律的物理科学は、急速に発展している新しい分野であり、知識の獲得プロセスを大幅に加速することで、科学的手法全体に革命をもたらす可能性を秘めている。
自律的物理科学では、機械学習が実験システムを制御し、最も情報量の多い実験を選択し、実行することを繰り返している。
実験室における自律的実験の最初の具体例としては、移動型ロボット化学者1、化学合成のための自動運転実験室2、自律的機械設計システム3、カーボンナノチューブ成長のための最適化ツール4などがある。
最近では、自律型放射光回折のデモンストレーション5,6が行われ、人工知能（AI）主導の実験の舞台は、割り当てられた実験ビームタイムが貴重な商品である国立研究所のビームライン環境へと広がっている。

特に中性子散乱では、測定時間の短縮とリソースの削減が求められている。
中性子回折は、磁気秩序パラメータを直接観測できる数少ない測定技術の一つである。
磁気秩序パラメータは、磁気秩序状態から無秩序状態への遷移挙動を記述する。
この磁気秩序転移がどのように、どのような温度で起こるかを理解することは、新しい磁性材料の発見にとって非常に重要である。
そのため、中性子科学施設のビームタイムは非常に重要視されている。
しかし、この強力な技術は、世界でもほんの一握りの施設でしか利用できず、需要が供給をはるかに上回っているのが現状である。

オーダーパラメータを研究するビームライン実験では、一般的に、ユーザーが適切な情報を見逃さないようにと、広いサンプリング範囲と高いサンプリング周波数を定義し、アドホックに定義された網羅的な測定を行う。
現在、これらの測定のスケジューリングについて、普遍的に合意された方法はない。
このアドホックなスケジューリングは、回折信号が強く、試料がよく知られている場合にはあまり問題にはならないが、信号が小さい試料（小さな磁気モーメント、小さな結晶、薄い膜など）や試料についてほとんど知られていない場合には効果がなく、無駄が生じる可能性がある。
この研究の目的の一つは、測定値から引き出せる統計的推論に基づいて測定値を選択することをアルゴリズム的に定式化することである。
従来のアドホックスケジュールでは、全データが収集されると、専門家が計算ツールを用いてデータを解析し、ターゲットパラメータを抽出する。
高フラックスの散乱実験（例えば、放射光X線回折測定）では、収集されたデータの大量かつ高速なため、適切な科学的情報を迅速に解明するための機械学習が必要となる7,8。
しかし、中性子回折実験のフラックスは一般的にはるかに低く、したがって、大規模なデータセットを収集することは面倒で時間がかかるものであった。
この課題は、典型的な網羅的手法では必要な量をはるかに超える測定値が得られるオーダーパラメーター調査に代表される。
このような課題に対して、機械学習は、自律制御によって後続の各実験をその場で最適化することで、知識獲得を加速する役割を果たすことができる。
本研究では、自律型中性子回折実験装置（ANDiE）を開発し、磁気転移の挙動を自己主導的に探索し、測定効率を大幅に向上させることに成功した。

この研究では、最適な実験設計（適応設計）に特化したAIの一分野である能動学習（AL）9と確率的モデリング／プログラミングを組み合わせることで、測定選択をその場でガイドすることができる。
最近の研究では、インシリコの自律的なキャンペーンにより、ベイズ手法を使用して中性子散乱測定の順序を決定できることが示されている10。
この研究では、事前に収集したデータ間を補間するためにガウス過程を使用することの有効性を示している。
本研究では、中性子散乱と磁気物理の知識を取り入れた物理ベースのアプローチによる自律的なライブ中性子散乱実験を初めて実証した。
物理ベースの知識をマルコフ連鎖モンテカルロ法（MCMC）のフレームワークに組み込むことで、ANDiEはその場で補間・外挿を行うことができるようになった。
この手法により、測定データの収集からモデルの予測に至るまで、プロセス全体を通じて不確実性を把握し、伝播させることができる。
さらに、ANDiEのMCMCフレームワークには先行物理が組み込まれており、解析結果は物理的に実現可能なものに限定されます。
これは、科学的AI（SciAI）という新分野の設計指針に沿ったものである11。
このようなSciAIによる自律的な実験は、中性子回折実験に必要な時間を大幅に短縮し、装置や専門家の時間を軽減することで、ある施設での実験を増やしたり、他の方法では実現不可能な実験を可能にする可能性を持っています。
私たちは、ANDiEが自律的にライブ中性子回折実験を行い、ネール温度（TN）を発見し、その後の試料の磁気構造の温度依存性に関する仮説検証を、通常必要な測定数の約5分の1で行うことに成功したことを示している。

アクティブラーニングのルーツは18世紀にまで遡り、ラプラスが天体の研究にALを用いたことにある12。
ベイズ最適化などのベイズAL手法は、予測値と関連する不確実性の両方を出力するために、確率的なモデリングを組み込んでいる。
これらの方法は、研究室やインシリコで未知の機能を最適化する科学者を導くのに特に有用である13-19。
材料科学の分野では、材料探索を加速させるために、自律的な実験が急務となっている20。
自律システムの原動力として、ALは、従来のAI最適化スキームを用いて、材料加工条件の最適化4,21,22、試料の特性評価6、技術的応用のためのポリマーや有機分子の組成1,2,23に有効であることが示されている。
自律システムにおけるこれらの取り組みの多くは、主に化学に焦点を当てたものであった24-26。
固体材料の自律システムという新分野のレビューでは、材料探索を加速し、複雑な材料と特性の関係を解明する上で、大きな期待が寄せられていることが示されている27,28。
これらのAIツールに事前の物理的知識をエンコードすることで、SciAIは解釈可能性を維持しつつ、知識の取得をさらに加速させるという大きな利点を有している。
例えば、材料探索と最適化のための閉ループ自律システム（CAMEO）アルゴリズムは、位相マッピングとX線回折の知識をエンコードし、材料最適化の加速において非SciAI手法よりも優れていることが実証され、クラス最高の相変化メモリ材料を発見する結果となった5。

ANDiEは、ベイズ型SciAIを採用し、中性子回折測定から磁気秩序変数の決定を高速化した。
磁気秩序変数は、磁気秩序転移の振る舞いを記述するものである。
例えば、1次転移を示す反強磁性体は温度で秩序変数が不連続になり、2次転移を示す反強磁性体は温度で秩序変数が連続になり、1次微分が温度で不連続になるといった現象が見られる。
可能であれば、事前の磁気測定、熱容量測定、輸送測定から、磁気秩序転移が示唆されることがある。
一方、磁気秩序は中性子回折で直接観測することができる。秩序状態における磁気モーメントから散乱する中性子によって、ブラッグ回折強度が増加するからである。
このため中性子回折は、前述のバルク評価法では測定が困難な物質（薄膜試料や不純物相を含む試料など）の磁気秩序化を研究することができる。
したがって、中性子回折は磁気秩序パラメータとTNを決定するための最も決定的な測定技術である。
ANDiEは、TNの事前分布を知るためにあらゆる予備的な特性評価測定を利用することができ、それにより、情報量の多いデータと正しいTN値をより早く収束させることが可能になる。
さらに、この中性子回折のプロセスにはいくつかのよく知られた物理原理があり、これらは秩序変数の自律的発見のためのアルゴリズムに組み込まれています。
これらには、回折強度がポアソン型の不確かさを持つこと、回折ピークが疑似ボイグトプロファイルでよく記述されること、回折強度の磁気成分が磁化の二乗に関係すること、などが含まれる29。
重要なのは、磁化の温度依存性が数種類のモデルに従うといえることである。
事前の物理的知識がどのように符号化されるかについての説明は、第II部にある。

回折実験は、まず転移温度以上から5Kのベース温度まで冷却することから始められる。
その後の各反復において、物理ベースの不確定性定量化により、磁気構造ピークパラメータとその温度依存性の知識を最大化するために、その後の等温回折測定の選択をガイドする。
この手法は、磁気構造解析のための等温ベイズ推論ステップと、温度依存性解析のための第2の熱ベイズ推論ステップを組み合わせている。
従来の能動学習スキームでは、最適な測定を行うために任意の温度を選択することが可能であったが、この課題ではそのようなスキームは不可能である。
一次相転移はヒステレティックであるため、測定されるTNは試料が温まっているか冷えているかに依存する。
さらに、TN以下の秩序変数はこのヒステレティックな性質のため、一度試料をベース温度以上に温めたら、秩序変数が同じ状態になるように冷却する前にTNより十分に高く温めなければならない。
この手順は法外にコストがかかる。特に、実験の目的がTNを発見することであることを考えると、無秩序状態を確実に達成するためには、加熱ステップを過大評価する必要がある。
これにより、温度の無制限な探索の可能性が阻まれる。
そこで、私たちは、取得関数を制限して、基準温度から温度を上昇させるだけにした。
実験温度が推定されたTNを大きく上回り、それ以上の情報が得られなくなるまで、測定プロセスが繰り返される。
図1にANDiE方式の構成図を示す。

FIG. 1.
: 自律型中性子回折装置ANDiE（Autonomous neutron diffraction explorer）のアルゴリズム図。
ANDiEは、ネール温度（TN）を発見し、その後の磁気構造の温度依存性の仮説検証を行うために、ライブの中性子回折実験を自律的に駆動する。
実線はオークリッジ国立研究所（ORNL）高フラックス同位体炉（HFIR）のHB-2Cビームラインの広角中性子回折計（WAND2）に実装したもので、破線は国立標準技術研究所（NIST）中性子研究センター（NCNR）のビームラインBT-4に追加実装した能動学習ループを示す。

米国国立標準技術研究所（NIST）中性子研究センター（NCNR）のBT-4ビームラインの点検出器とオークリッジ国立研究所（ORNL）高フラックス同位体炉（HFIR）のHB-2Cビームラインの広角中性子回折計（WAND2）の両方にANDiEが導入されました。
ANDiEは、人間の介入なしにこれらの装置を制御し、MnOとFe1.09Teの両方の粉末試料のTNを自律的に発見することに成功し、そのための温度ステップ数を従来のアドホックスケジュール実験と比較して約5分の1に削減することが可能になった。
さらに、ANDiEは仮説検証を行い、磁気構造の温度依存性に対して正しい物理モデル（1次、Ising型2次、Weiss型2次）を特定します。
そして、そのモデルを尤度の高い順に並べ、一番上のモデルを選択する。このように、ANDiEは中性子回折実験の効率を飛躍的に向上させることが可能であることを示した。

## II. MATERIALS AND METHODS

### A. Algorithm

等温推定では、2つのPseudo-Voigtピークと一定のバックグラウンドから構築された、目的の2θ回折空間範囲における回折強度のモデルを使用した。
2θ空間における回折強度のフルモデルは次式で与えられる。
式(1)
ここで、ζMagとζStructはスケーリングファクター、ωMagとωStructは2θ空間のピーク位置、αMag、γMag、αStruct、γStructはそれぞれ磁気ピークと構造ピークに対するPseudo-Voigtピーク形状パラメータ、IBackはバックグラウンド強度を示す。

Sec.III A で述べるように、Weiss 方程式を用いて自律実験中の局所磁気モーメントの温度依存性を予測する30 。
回折ピークの形状が実験中に強く変化しないことを仮定すると、磁気回折ピークの最大強度は積分強度に比例する。
したがって、磁気回折強度の温度依存性に関する完全なWeissモデルは、次式で与えられる。
式(2a)
式(2b)
ここで、root𝑚[]は角括弧内の式のmに関する根を求める操作、mは還元磁化、Tはケルビン温度、I（T）は回折強度、TNは磁気転移温度、Jは量子全角運動量、M0は最大自発磁化に比例するスケールパラメータ、BJ（x）はブリリアン関数、Bkはバックグラウンド強度を示す。
なお、式(2a)のM0は最大自発磁化と回折強度と磁気モーメントの二乗の間の未知の比例定数の平方根を合成したものである。

次の温度を選択するために、温度値を探索し（ステップサイズは0.5K）、モデルの信頼区間（CI）が、モデルの平均によって予測されるポアソン的な不確かさに相対する閾値を超える次の温度を特定する。
能動学習スキームを温度の上昇に限定することで、ヒステリシス効果を回避することができる。
温度がTNの上限信頼区間を超えると、モデルの信頼区間はもはや温度に依存しなくなる（背景が適合すべき唯一のパラメータとなるため）。
そして、TNを超える大きな温度ステップが取られる。

自律実験において全データセットが収集されると、ANDiEは後処理として仮説検証を行い、第III章で述べたモデルのうちどれが最も可能性が高いかを決定する。
一次モデルは以下の式で与えられる。
式(3)
ここで、Kは強度スケーリング定数、σはステップ関数のガウス畳み込みの半値全幅であり、遷移の幅を表すのに使われる。
最後に、イジングモデルは次式で与えられる。
式(4)
ここで、βは臨界指数である。
式(4)はTN付近でのみ有効であることに注意が必要であり、我々はT > 0.5TNを用いて強制している。

ANDiEは3つのモデルそれぞれを用いて推論を行う。
Isingモデルによる推論はTNを推論し、したがって、Isingモデルが有効である範囲も推論することに注意してください。
3つのモデル間の対数尤度を公平に比較するために、Isingモデルの推論が完了したら、Isingモデルの有効範囲内に入るデータポイントのみを用いて、一次モデルとWeissモデルの推論を再実行します。
もし、その範囲内のデータポイントからイジングモデルが最有力でない場合は、自律実験によって得られた全温度範囲に対する推論を用いて、一次モデルとWeissモデルを比較する。

各モデルのすべてのパラメータは、物理的な制限（例えば、TNは負になりえない）および専門家からの推定値に基づく事前打ち切り正規分布で初期化されます。
ANDiEはDREAMサンプラー31を使用してMCMC推論を行います。
各モデル（等温推論と熱推論の両方）に対して、モデルが与えられた場合にデータを観測する確率を決定するために、見込み曲線の周りのガウス尤度を使用します。
これらの尤度分布の幅はモデルと測定器の不確かさによって決まる32,33。これはこれらのポアソン的過程の高度に不均一な性質を捉えたものである。
ここで示した中性子回折データの自律的な解析は、Mantidフレームワークを用いて中性子イベントデータを自動的にスペクトルに還元するデータパイプライン34によって可能になりました35。

完全なアルゴリズムはPythonで書かれ、回折パターンの解析、次の温度の選択、データ取得との通信を人間の介入なしに行うJupyter notebookに実装されている。
自律実験中に使用されたANDiEノートブックは、<https://github.com/usnistgov/ANDiE-v1_0> で入手できます。
DREAM サンプラーを用いた MCMC 関数には BUMPS ライブラリー36 を使用した31。
熱推論には，sci-kit learn library37 の数値根探索アルゴリズムを用いて，MCMC チェーンの各ステップで Weiss 方程式の根を解いた．

### B. Experimental set-up

回折実験はORNLのHFIRのWAND2 HB-2Cビームラインで行われ、波長は1.4828Åであった。
初期のアルゴリズム開発は、NISTのNCNRのBT-4ビームラインで行われた実験を使用した。
MnO粉末はSigma Aldrich (Cat. # 377201)*から購入した。
Fe1.09Te粉末サンプルの合成の詳細については、Ref.38に記載がある。38.
MnO と Fe1.09Te の両粉末試料は、He 雰囲気下で密閉したバナジウム缶の中で測定した。
低温にするために、He 交換ガスを用いた温度可変インサート (VTI) 付きのトップローディング型密閉型冷蔵庫を使用した。

## III. RESULTS AND DISCUSSION

### A. MnOの磁気転移挙動の自律的発見

この自律型研究用中性子回折システムの最初のデモンストレーションでは、まず、よく研究されている物質であるMnOを取り上げ、ANDiEが既知の結果を再現できることを確認した。
また、III B項では、ANDiEが発見した鋭い一次転移を持つ、より困難な物質Fe1.09Teを考察している。
これらの研究は、ANDiEの頑健性を示すものであり、今後の研究では、磁気転移の挙動が未知の物質に対しても、自信を持ってANDiEを用いることができるようになる。
磁気伝搬ベクトル、つまり2θ空間での回折ピーク位置が温度の強い関数である物質も存在する39,40。
さらに、回折パターンに対する磁気的寄与の強度も、特に秩序化温度にわたって強い温度関数となる［図2 (a) と図2 (b) を参照］。
その結果、等温モデルパラメータは、温度依存性実験が進むにつれて劇的に変化する可能性がある。
このため、このような多様な挙動を捉えることができる信頼性の高いアルゴリズム基盤が必要とされている。
ベイズ推定は、任意の1つの温度および複数の温度における材料を記述するための、ロバストで確率的な方法を提供する。
ベイズ推定は、データ解析と予測を改善するために事前知識を利用することができ、不確実性の定量化と伝播のためのフレームワークを提供する。
最小二乗フィッティングのような単純な手法とは対照的に、このベイズ的な枠組みでは、より正確な不確実性をもってデータからパラメータを推定することが可能だ。
データは不確かさの境界で入力することができ、目標パラメータは期待値と不確かさを持つ確率分布として出力されます。
特にANDiEでは、MCMCに基づくベイズ推定を用いて、各等温回折測定値から磁気成分を抽出しています。
大域的な最適化にMCMC推論を用いることで、潜在的なパラメータ値の範囲が広いにもかかわらず、ピークパラメータ決定の高い信頼性を確保することができる。
MCMCは、回折データに存在する無数のローカルミニマムを回避するのに特に適している41。
これに対し、Levenberg-Marquardtアルゴリズムなどの他の最適化スキームは、初期化がグローバルミニマムに近い場合にのみうまく機能し、そうでない場合は発散する可能性がある。
さらに、MCMCでは、測定された強度のポアソン的な計数統計などの物理学の事前知識を符号化することができ、それによって回折角（および次の段落で示すように温度）の関数としての強度の非常に不均一な性質を説明することができる。
さらに、パラメータのMCMC事前推定、すなわち、以前のX線回折測定からの核ピーク位置、または文献の以前の報告からの情報を含めることができる。
能動学習のプロセスは、2θの関心範囲を事前に特定することから始まる。
MnOの場合は、検出器の2θの範囲である28.0°から37.0°から開始した。この範囲には（111）核ピークとその近くの（32 12 12）磁気ピークが含まれる。
次にANDiEは、擬似ボイグトピークのガウス成分とローレンツ成分の位置、高さ、半値幅、およびバックグラウンド項を含むピーク形状パラメーターの確率分布を推論する。
図2は、5.0 Kと129.5 Kでの推論結果である。

FIG. 2.
: MnOの等温推算。
実験温度(T)が(a)5.0Kと(b)129.5Kで、関心領域のMnO回折データに対して等温推算が行われた。
オレンジ色の磁気信頼区間は、等温モデルの磁気成分の信頼区間を示している。
32.18°付近の磁気ピークパラメータ(32 12 12)が温度によってどのように変化しているかに注意。
大域的最適化MCMCアルゴリズムにより、このような大きな変化にもかかわらず、適切なプロファイルが推定されている。
青で示した測定値のエラーバーは1標準偏差を表し、記号の大きさよりも小さい。

ANDiEは、各等温測定で推定されたピークパラメータ分布を用いて、回折の磁性成分の温度依存性を予測することができる。
中性子回折強度の磁気成分は、磁気モーメントの2乗に関係する29。
いくつかのモデルで温度依存性を記述することができる。
本研究では、1次相転移モデルとIsingおよびWeissの2次相転移モデルを検討する。
一次相転移モデルは、誤差関数、すなわちステップ関数に狭いガウス関数を畳み込んだものである。
このモデルはTN付近でしかゼロでない傾きを持たないため、推論による予測はその後の温度ステップの選択に役立たない。つまり、実験温度が数ケルビン以内（つまりガウス関数内）になるまでTNに近づいていることを示すことができない。
したがって、研究対象の材料が一次転移の挙動を示すと疑われる場合でも、自律実験中に一次モデルを使用することは適切では無い。
そこで、ANDiEでは、自律実験中に2次モデルを用いて予測を行う。
そして、すべてのデータを収集した後にベイズ因子検定を行い、材料が一次挙動を示すかどうかを判断する。

2次相転移モデルはTNよりはるかに低い温度でゼロでないスロープを持つため、適切な温度ステップを予測するために使用することができる。
しかし、イジングモデルは TN の近傍、0.5TN < T < TN の範囲でのみ有効であるのに対し42 、ワイスモデルは TN 以下の全温度範囲にわたって有効である。
したがって、研究対象の材料や疑われる挙動にかかわらず、ANDiEは自律実験中にWeissモデルを使用してデータ収集を駆動し、後処理でベイズ係数を用いて最も適切なモデルを決定する。
それぞれのモデルのカーブ例を図3に示す。

FIG. 3.
: 熱推算のためのモデル例
中性子回折強度の磁性成分の温度依存性には、いくつかのモデルがある。
黒い曲線は一次モデルである。
イジングモデルは赤で示され、破線の領域はこのモデルの有効範囲外である。
Weissモデルは青色で示されている。

このような理由から、研究対象の材料に関係なく、ANDiEはWeissモデルを使用して後続の測定の温度ステップを選択し、知識を低温から高温に伝搬させる。
この物理情報に基づくアプローチは、より一般的なべき乗則やガウスプロセスのような代理のMLモデルに比べていくつかの利点がある。
第一に、WeissモデルはANDiEを物理的に意味のある解、すなわち、正の温度、正の強度、単調な温度依存性だけに制約する。
次に、Weissモデルを用いると、ANDiEは低温と転移温度周辺の最も情報量の多い領域に測定値を集中させることを実証した。
さらに、ANDiEは、これらの領域以外の曲率とバックグラウンドを適切に特徴付けるために、最小限の数の測定値を使用する。
このことは、実際の材料の挙動に関わらず、また、TNの広範な事前推定のみを用いても同様であることがわかった。
2 次転移を持つ材料の場合、Weiss モデルは、情報提供温度までデータ収集を行うのに十分な柔軟性を持っている。
本当に突然の不連続な1次転移の場合、そのようなステップ関数を発見することは困難な作業であり、数回の冷却と加温サイクルを繰り返して反復して解くしかなく、ANDiEを実装してこれらの反復を自律的に行うことができる。
しかし、多くの材料に見られるように、理想的な一次挙動からの摂動（短距離秩序など）があれば、Weissモデルの柔軟性により、ANDiEはTN付近のデータをより多く収集することができる。
このように、ANDiEはWeissモデルを用いて、1回の加温サイクルからTN（遷移挙動を決定するのに十分なデータ）を発見することができる。

中性子回折強度はポアソン型の計数統計に従うため、その過程は高度に不均一であり、信号の不確かさは探索領域全体で高度に不均一であることを意味する。
回折強度の不確かさ（連続近似を用いたガウス分布の標準偏差で推定）は、回折強度の平方根に関係する。
一般的な取得関数は不均一性を考慮しないため、強度の高い領域を強調しすぎる傾向があり、その領域で不必要に多くのデータを取得することになる。
そこでANDiEは、モデルの信頼区間（測定回数に依存する値）と、強度外挿から予測される不確かさを比較する。
ANDiEは、この比率がBravery factorと呼ぶある閾値を超えるまで、温度を上昇させる。
モデルの分散は、測定されたデータから、各温度における強度がどの程度知られているかを示す尺度である。
予測される不確かさは、その温度で測定が行われた場合、強度の値についてどの程度知ることができると予想されるかを示す尺度である。
これら2つの値の比率は、その測定がモデルにとってどれだけ有益であるかを表す。
Braveryファクターを設定することで、この比率の閾値が決定され、それ以上であれば測定は有用であるとみなされる。
比率がBravery factor以下の温度は安全にスキップすることができ、その閾値に達するまで実験温度を上昇させることができる。
したがって、Braveryファクターはユーザーのリスク許容度を表し、実験の目的に応じて変更することができる。
材料についてほとんど知られていない場合、空間を素早く探索するために高いBraveryファクターが適切かもしれない。
しかし、実験の目的がTNの測定を微調整することである場合、小さな温度ステップしか踏まないように、ブレイバリーファクターを小さくすることが適切かもしれない（つまり、中程度の情報しかない測定はまだ有用である）。

図4は、MnOのTNを自律的に発見したときのANDiEのパフォーマンスを示したものである。
温度依存性を推測するためのデータが少ないため、自律的な実験の初期には小さな温度ステップを選択する。
データが増えるにつれて、ANDiEはTNに近づくまで、より大きな温度ステップをとる。
TN付近では、モデルの傾きが急なため、自然と推論の信頼区間が広くなり、その領域でより多くのデータを取得する。
このようにして、ANDiEは有益でない温度はスキップし、速やかにTNに収束する。
14回の温度ステップの後、ANDiEは実験温度がTNを上回ると推論している。
この領域では、さらなるデータポイントの選択は任意であり、10Kステップで複数の測定が行われた。
この数段階での推論結果をFig.4に示す。
16回の温度ステップの後、ANDiEは実験の停止基準に到達した。
ANDiEは最も可能性の高いパラメータに素早く収束した。
前述のように、従来のアドホックスケジューリングには普遍的に合意された方法がなく、研究者の直感によって決定され、特に小さな信号（磁気モーメントの小さな物質、小さな結晶試料、薄膜からの信号など）では困難であった。
比較のために、情報に基づいたアドホックスケジュールは、TNの事前推測から10K以内で0.5Kステップ、TNの事前推測から20K以内で2Kステップ、それ以外で5Kステップ、合計74の温度ステップを取ることができる。
したがって、ANDiEは実験に必要な温度ステップ数を約5分の1に削減することができる。

FIG. 4.
: MnOの熱推論スナップショット。
熱推論ステップは、Weissモデルを用いたMnO磁気（32 12 12）反射の温度依存性についての自律実験中に実行された。
結果は、(a)1回測定後、(b)ネール温度(TN)付近で12回測定後、(c)自律実験終了時に16回測定後に決定したものを示している。
各モデルの推論の事後曲線(MP)の平均を赤で示す。
各モデルの最適パラメータ(BP)は黒の破線で、信頼区間(CI)は灰色の包絡線で示されている。
各部の緑色の縦線は、アルゴリズムが次に計測するために選択した温度を示す。
測定されたデータ点のエラーバーは青で示したメーカーよりも小さく、(c)ではモデルの信頼区間が後者の平均の線幅よりも小さくなっている。

自律的な実験が停止基準に達した後、ANDiEは仮説検証を行い、ここで検討されたモデルのうち、どのモデルの可能性が高いかを決定する。
イジングモデルはTN付近でのみ有効であるため、モデルの尤度を比較する範囲を決定する。
したがって、ANDiEは、まずIsingモデルで推論を行う。
その後、他のモデルについて同じ温度範囲での推論を行う。
もしIsingモデルが適切な範囲で最も可能性が高くない場合、ANDiEはデータセット全体にわたって1次モデルとWeissモデルの尤度を比較する。
図5は、最も可能性の高いモデルとして決定されたIsingモデルの推論結果を示しており、推定TNは120.81(56)Kであった。
表Iは全てのモデルの結果をまとめたものである。
TN の予測値の不確かさは、データポイントが与えられたときのそのパラメータに対するモデルの信頼度を反映している。
これらの信頼区間は、モデルが物理的に適用可能である限りにおいてのみ、パラメータの不確かさを表している。
例えば、MnO の場合、Weiss モデルは物理的に意味のあるものではなさそうである。
したがって、これは、その試料のWeissモデルから導かれるTNの不確かさにも当てはまる。
1 次モデルと Weiss モデルがこの予測において物理的でない低い不確かさを持つという事実は、TN をさらに調整してもデータへの適合が改善されないことを示している。
このことは、これらのモデルの大きな負の対数尤度が、データに対して適切でないことを示していることにも反映されている。
一方、Isingモデルは、より高い対数尤度によって証明されるように、適切である。
したがって、Isingモデルの推論から得られるTNパラメータの信頼度は、TNの不確実性を測る良い指標となる。
これに従い、ANDiEはMnOがイジング型反強磁性体であり、TNは120.81(56)Kであり、文献と一致すると結論付けている42-44。

FIG. 5.
: イジングモデルの仮説検証
後処理仮説検定ステップで行ったMnO磁気（32 12 12）反射の温度依存性に対してイジングモデル推論を行い、最も可能性の高いモデルであると判定した。
測定データ点のエラーバーはメーカーより小さく、モデルの信頼区間は後者の平均の線幅より小さい。

TABLE I.
: 熱推算の結果。
予測されたネール温度（TN）とモデルの対数尤度は、ORNLのHFIRのHB-2CでWAND2を用いたMnOとFe1.09Teの自律中性子回折実験の後処理仮説検定で使用されています。
イジングモデルはTN付近でのみ有効であることに注意が必要である。
TNの予測の不確かさは、データを与えられたそのパラメータに対するそのモデルの信頼度を反映している。
これらの信頼区間は、高い対数尤度によって証明されるように、モデルが物理的に適切である場合にのみ、不確実性の良い測定値となる。
不確実性は、(##)が値の最後の2桁の不確実性を表すコンパクトな表記で示されていることに注意。
太字は、ANDiEが結論づけた各材料の最も可能性の高いモデルの結果を示している。

### B. Fe1.09Teの磁気転移挙動の自律的発見

2次転移の研究が進んでいるMnOの磁気転移を測定し、その有効性を確認した後、より難易度の高いFe-Te系にANDiEを適用している。
Fe1+xTeは、格子間鉄（化学式中のx）の関数として、複雑な磁気挙動を示す45。
格子間鉄が約11%以下では、反強磁性相への一次相転移が見られる。
Fe1+xTeのこの転移のTNは、x=0%で70K、x=11%で52Kの範囲にある。
Fe1.09TeのTNを正確に決定することは、広い温度範囲で突然のステップ状の一次転移が起こる可能性があるため、難しい課題である。
実際、図 6(a)は、アドホック測定スケジュール（自律運転の後に別の実験として実施）により取得した 69.436(55) K での Fe1.09Te の磁気 (12 0 12) 反射の回折強度において、この転移が明瞭であることを示している。
ANDiEはWeiss型遷移モデルを先行させ、わずか14回の測定でこの遷移を発見した。
これは、アドホックなスケジュールと比較して、約4倍の改善となる。
時間短縮の考察、計算機的考察、および自律的実験の実施に伴う推論の進展を撮影したビデオを補足資料に掲載している。
現在、ANDiEの実装に用いられているコードは発展的なものであり、自律的な意思決定を実証するには十分強固であるが、将来の研究では、並列計算機を用いて計算を高速化できることに留意したい（補足資料、第II章の計算時間に関する考察を参照）。
データを収集した後、ANDiEは次にイジング、ヴァイス、1次モデルのモデル比較を行う[図6（b）-6（f）に示すように]。
その結果、Isingモデル[図6(d)]はデータとの一致度が高いが、同じ温度範囲では1次モデル[図6(f)]の方がよりよく挙動を記述していることが分かる。
これは特にTN付近で顕著である。
この低強度のデータは、ポワソン的な統計量に起因する低い不確かさを持っている。
この測定値の不確かさをベイズの枠組みで伝播させた結果、低強度におけるモデルと測定値の間の数カウントのずれは、高強度における数カウントのずれよりもはるかに小さくなる。
したがって、モデルとデータ間の偏差は、モデル尤度の計算において、低強度においてより大きくペナルティーを受ける。
モデル選択に用いた対数尤度と予測遷移温度のまとめをTable Iに示す。
ここで、上記の場合と同様に、モデルからの信頼区間は、そのモデルが物理的に適切である場合にのみ、不確実性の良い指標となることに注目したい。
全温度範囲のデータを考慮すると、1次モデルの対数尤度が高いことから、このモデルが最も可能性が高いことがわかる。
したがって、ANDiEは68.58(16)KのTNで一次転移挙動を正しく推定し、これはアドホックスケジュールで測定したものと一致する。
この磁気秩序化挙動は、以前に報告されたFe1+xTeの相図から予想されるものと同様である45。
したがって、ANDiEは、実際の振る舞いが事前の予測からかけ離れている場合でも、非常に少ない測定回数で磁気秩序変数の振る舞いを発見することができる。

FIG. 6.
: 自律的な測定と仮説検証 vs アドホックなスケジュール。
等温推論から求めたFe1.09Teの磁気（12 0 12）反射の強度を青色で示す。
アドホックスケジュールを(a)に示す。
仮説検証は、自律的に得られた測定値に対して、(b) Weissモデル、(c) 1次モデル、(d) Isingモデルの推論をそれぞれ用いて行われた。
(e)Weissモデル、(f)一次モデルは、実験温度がIsing推定によるNéel温度（TN）の推定値の半分より大きいデータ（T > 0.5TN）で再トレーニングを行った。
各モデルの推論の事後曲線(MP)の平均を赤で示す。
各モデルの最良パラメータ(BP)は黒の破線曲線で、信頼区間(CI)は灰色の包絡線で示す。
Weissモデルは自律実験の駆動に用いられた。
Fe1.09Teのこの遷移では、1次モデルが最も可能性が高いと判断された。
青で示された測定データ点のエラーバーはメーカーより小さく、モデルの信頼区間は後者の平均の線幅より小さい。

これらの結果は、ANDiEが自律的に材料のTNを発見し、基本的なモデル選択を行うことができることを、自律的に駆動する初のライブ中性子回折実験において示したものである。
本実証は、これまで研究が進んでいなかった物質について、TNと転移挙動の発見を行い、単純な概念実証にとどまらない成果を上げている。
さらに、ANDiEの1パスで、1度以下のTNを発見し、簡単なモデル選択を行うという目的を達成することができることを実証している。
臨界指数の正確な決定は今回のプロトタイプの範囲外ですが、ANDiEを一般化してそのタスクを達成することができる。
将来的には、より困難な発見を行うために、事前分布を更新してANDiEを実行する際に、基本温度まで冷却する条件を含めることも可能である。

## IV. CONCLUSION

我々は、磁気転移温度発見のための中性子回折実験を制御するシステムである自律型中性子回折実験装置(ANDiE)を開発した。
このシステムは、ベイズ的なアプローチで実験温度を選択し、確率的な予測を提供するだけでなく、目の前の問題に関連する物理を符号化する。
常にWeissモデルでデータを取得するにもかかわらず、磁気的挙動が異なる材料系の磁気転移温度を発見することができるANDiEの汎用性を実証した。
このモデルは、研究対象の材料が期待する挙動とは異なる可能性があるにもかかわらず、効率的に転移温度を発見するために次の温度を選択するのに役立っている。
ANDiEは、温度ステップの数をほぼ5分の1に減らすことでデータ取得を高速化し、その後、転移の支配的な物理原理を決定するための仮説検証を実行することができる。
データ取得後の仮説検証では、MnOのイジング型転移を120.81(56)Kで正しく同定することができた。
Fe1.09Teのような突然のステップ状一次転移という難しいケースでも、ANDiEは効率的に実験を進めることができ、わずか14回の測定で68.52（16）Kでの一次転移挙動を発見することができた。
現在実装されているANDiEは、先に述べた3つのモデル間の尤度を比較する。
仮説検証をユーザーが決めた追加モデルに拡張するのは簡単な作業である。
さらに、ANDiEに実装されている方法は、様々な中性子実験に簡単に拡張することができる。
例えば、NCNRのBT-4のような点検出器装置で回折角空間における能動学習を実装し、回折ピークの高速探索を行うなど、実験の次元に応じた高速化が期待される。
同様に、我々の能動学習方式を印加磁場空間で用いれば、それらの実験の測定回数を減らすことができる。
ANDiEが用いた手法は、一般的に適用可能な物理モデルを用いてコストのかかる実験条件を効率的にナビゲートできる他の測定（X線回折や機能性測定など）にも応用できる。
ここで紹介した自律型システムは、材料探索を加速するための高速中性子散乱実験の可能性を例証するものである。

## LICENCE

Article by A. McDannald, M. Frontzek, A. T. Savici, M. Doucet, E. E. Rodriguez, K. Meuse, J. Opsahl-Ong, D. Samarov, I. Takeuchi, W. Ratcliff, & A. G. Kusne, "On-the-fly autonomous control of neutron diffraction via physics-informed Bayesian active learning", _Applied Physics Reviews_, **9** 021408 (2022). [https://doi.org/10.1063/5.0082956](https://doi.org/10.1063/5.0082956) / Cited under [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/) / Translated by [Yuki Sakishita](https://y-saki26.github.io/pages/).
